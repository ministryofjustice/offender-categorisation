{% extends "../formTemplate.html" %}

{% from "radios/macro.njk" import govukRadios %}

{% from "warning-text/macro.njk" import govukWarningText %}
{% from "character-count/macro.njk" import govukCharacterCount %}

{% macro renderAlert(alert) %}
  <p class="govuk-!-margin-bottom-1">{{ alert.alertCode }} {{ alert.comment }} <strong>{{ alert.dateCreated }}</strong>
    {% if alert.expired %} (expired){% endif %}
    {% if not alert.active %} (inactive){% endif %}
  </p>
{% endmacro %}

{% block formItems %}

<h1 class="govuk-heading-l">Risk of escape</h1>

{% if data.escapeProfile.activeEscapeList or data.escapeProfile.activeEscapeRisk %}
  {{ govukWarningText({
    text: 'This person is considered an escape risk',
    iconFallbackText: "Warning",
    classes: "forms-warning-text"
  }) }}

  <h2 class="govuk-heading-s">Alert notes</h2>
  <div class="govuk-details__text govuk-body-m govuk-!-margin-bottom-3">
    {% for alert in data.escapeProfile.escapeListAlerts %}
      {{ renderAlert(alert) }}
    {% endfor %}
    {% for alert in data.escapeProfile.escapeRiskAlerts %}
      {{ renderAlert(alert) }}
    {% endfor %}
  </div>
{% endif %}

{% set escapeTextHtml %}

{{ govukCharacterCount({
  name: "escapeFurtherChargesText",
  type: "escapeFurtherChargesText",
  id: "escapeFurtherChargesText",
  maxlength: 50000,
  threshold: 50,
  label: {
    text: "Provide details of these charges"
  },
  value: data.ratings.escapeRating.escapeFurtherChargesText,
  errorMessage: {
    text: "Please enter details of these charges"
  } if (errors | findError('escapeFurtherChargesText'))
}) }}

{% endset -%}

{{ govukRadios({
  name: "escapeFurtherCharges",
  classes: "govuk-radios--inline",
  fieldset: {
    legend: {
      text: "Is there any other evidence to suggest this person poses a risk of escape?",
      isPageHeading: false
    }
  },
  errorMessage: {
    text: "Please select yes or no"
    } if (errors | findError('escapeFurtherCharges')),
  items: [
  {
    value: "Yes",
    text: "Yes",
    checked: data.ratings.escapeRating.escapeFurtherCharges === 'Yes',
    conditional: {
    html:escapeTextHtml
  }
  },
  {
    value: "No",
    checked: data.ratings.escapeRating.escapeFurtherCharges === 'No',
    text: "No"
  }
  ]
}) }}

{% endblock %}
