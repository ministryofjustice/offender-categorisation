{% extends "../formTemplate.html" %}
{% from "warning-text/macro.njk" import govukWarningText %}
{% from "textarea/macro.njk" import govukTextarea %}
{% from "button/macro.njk" import govukButton %}
{% from "radios/macro.njk" import govukRadios %}

{% set greenButtonText = "Continue" %}

{% block formItems %}


<div class="govuk-grid-row govuk-body-s">
  <div class="govuk-grid-column-two-thirds">

    <h1 class="govuk-heading-l">Review provisional categorisation</h1>

    {% set cat = data.provisionalCategory.suggestedCategory %}
    {% set overriddenCat = data.provisionalCategory.overriddenCategory %}
    {% set currentCat %}{% if overriddenCat %}{{overriddenCat}}{% else %}{{cat}}{% endif %}{% endset %}


    {% if overriddenCat %}
    <div class="govuk-warning-text forms-info-text warning-overrides">
      <span id="override-old-cat-icon" class="govuk-warning-text__icon" aria-hidden="true">{{ cat }}</span>
      <span id="warning-arrow" class=""><img src='/assets/images/Triangle.png' alt='arrow' height='18'
                                             width='12'/></span>
      <span id="override-cat-icon" class="govuk-warning-text__icon" aria-hidden="true">{{ overriddenCat }}</span>
      <strong id="override-icon-text" class="govuk-warning-text__text">
        <span class="govuk-warning-text__assistive">Warning</span>
        The category was originally {{ cat }} and is now {{ overriddenCat }}
      </strong>
    </div>
    <div>
      <label class="govuk-label" for="overriddenText">
        Reason for overriding the suggested category
      </label>
      <div class="forms-info-text" id=overriddenText">{{ data.provisionalCategory.overriddenCategoryText }}
      </div>
    </div>
    {% else %}
    <div class="govuk-warning-text forms-info-text warning-overrides">
      <span class="govuk-warning-text__icon" aria-hidden="true">{{ cat }}</span>
      <strong class="govuk-warning-text__text">
        <span class="govuk-warning-text__assistive">Warning</span>
        Based on the information provided, the provisional category is {{ cat }}
      </strong>
    </div>
    {% endif %}


    {% set showChangeLinks %}false{% endset %}
    {% include "../../partials/reviewContents.html" %}


    {% set overriddenCategoryTextHtml %}

    {% if (currentCat == "B" or currentCat == "C" or currentCat == "D") %}
      {{ govukRadios({
        name: "supervisorOverriddenCategory",
        classes: "govuk-radios--inline",
        fieldset: {
        legend: {
        text: "Which category is more appropriate?",
        isPageHeading: false
      }
      },
      items: [
      {
        value: "B",
        id: "overriddenCategoryB",
        checked: data.review.supervisorOverriddenCategory === 'B',
        text: "B",
        B: true
        },
      {
        value: "C",
        id: "overriddenCategoryC",
        checked: data.review.supervisorOverriddenCategory === 'C',
        text: "C",
        C: true
        },
      {
        value: "D",
        id: "overriddenCategoryD",
        checked: data.review.supervisorOverriddenCategory === 'D',
        text: "D",
        D: true
        }
    ] | rejectattr(currentCat),
      errorMessage: {
        text: "Please select the new category"
        } if (errors | findError('supervisorOverriddenCategory'))
      }) }}
      {% else %}
      <h2 class="govuk-heading-m">Changing to Cat J</h2>
      <input type="hidden" name="supervisorOverriddenCategory" value="J"/>
    {% endif %}

    {{ govukTextarea({
      name: "supervisorOverriddenCategoryText",
      type: "myTextWhatsThisFor",
      id: "supervisorOverriddenCategoryText",
      label: {
      text: "Explain why you changed the category"
      },
      value: data.review.supervisorOverriddenCategoryText,
      errorMessage: {
      text: "Please enter the reason why you changed the category"
      } if (errors | findError('supervisorOverriddenCategoryText'))
      }) }}
    {% endset %}


    {{ govukRadios({
      name: "supervisorCategoryAppropriate",
      classes: "govuk-radios--inline",
      fieldset: {
        legend: {
          text: "Do you agree with the provisional category?",
          isPageHeading: false,
          classes: "govuk-heading-m govuk-!-font-weight-bold"
        },
      classes: "govuk-!-margin-top-7"
      },
      errorMessage: {
      text: "Select yes if you agree with the provisional category"
      } if (errors | findError('supervisorCategoryAppropriate')),
      items: [
        {
          value: "Yes",
          checked: data.review.supervisorCategoryAppropriate === 'Yes',
          text: "Yes"
        },
        {
          value: "No",
          checked: data.review.supervisorCategoryAppropriate === 'No',
          text: "No",
          conditional: {
            html:overriddenCategoryTextHtml
          }
        }
      ]
    }) }}

    <input type="hidden" name="proposedCategory" value="{{ currentCat }}"/>

  </div>
</div>


{% endblock %}
