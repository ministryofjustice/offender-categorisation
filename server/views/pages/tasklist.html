{% extends "../partials/layout.html" %}
{% from "button/macro.njk" import govukButton %}
{% from "back-link/macro.njk" import govukBackLink %}

{% block beforeContent %}

{{ govukBackLink({
text: "Back",
href: backLink or "/"
}) }}

{% endblock %}

{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <h1 class="govuk-heading-l">Categorisation task list</h1>
    </div>
  </div>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <h1 class="govuk-heading-s">Offender details</h1>
    </div>
  </div>

  {% include "../partials/offenderDetails.html" %}

  {% set offendingHistoryCompleted = data.ratings.offendingHistory.previousConvictions %}
  {% set locked = data.status === Status.SECURITY_MANUAL.name or data.status === Status.SECURITY_AUTO.name %}
  {% set securityInputCompleted = data.ratings.securityInput.securityInputNeeded %}
  {% set violenceRatingCompleted = data.ratings.violenceRating.highRiskOfViolence and data.ratings.violenceRating.seriousThreat %}
  {% set escapeRatingCompleted = data.ratings.escapeRating.escapeFurtherCharges %}
  {% set extremismRatingCompleted = data.ratings.extremismRating.previousTerrorismOffences %}
  {% set allSectionsCompleted = offendingHistoryCompleted and securityInputCompleted and not locked and violenceRatingCompleted and escapeRatingCompleted and extremismRatingCompleted %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <ul class="app-task-list">
        <li>
          <ul class="app-task-list__items">
            <li class="app-task-list__item">
              {% if offendingHistoryCompleted %}
                <a href="/form/ratings/offendingHistory/{{ data.bookingId }}">Offending history</a>
                <strong class="govuk-tag app-task-list__task-completed" id="offendingHistory-completed">Completed</strong>
              {% else %}
                {{ govukButton({
                text: "Start",
                href: "/form/ratings/offendingHistory/" + data.bookingId,
                classes: "govuk-button--start tableButton app-task-list__task-completed",
                attributes:
                  {  'id': 'offendingHistoryButton' }
                }) }}
                <p class="govuk-!-font-weight-bold">Offending history</p>
                <p class="govuk-body-s govuk-!-margin-top-2">Not yet checked</p>
              {% endif %}
            </li>
            <li class="app-task-list__item" id="securitySection">
              {% if securityInputCompleted and not locked %}
                <a id="security-input-edit" href="/form/ratings/securityInput/{{ data.bookingId }}">Security input</a>
                <strong class="govuk-tag app-task-list__task-completed" id="securityInput-completed">Completed</strong>
              {% else %}
                {{ govukButton({
                  text: "Start",
                  href: "/form/ratings/securityInput/" + data.bookingId if not locked,
                  disabled: locked,
                  classes: "govuk-button--start tableButton app-task-list__task-completed",
                  attributes:
                    { 'id': 'securityButton' }
                  })
                }}
                <p class="govuk-!-font-weight-bold">Security input</p>
                <p class="govuk-body-s govuk-!-margin-top-2">{{ Status[data.status].value + ' (' + data.referredDate + ')' if locked else 'Not yet checked' }}</p>
              {% endif %}
            </li>
            <li class="app-task-list__item">
              {% if violenceRatingCompleted %}
                <a href="/form/ratings/violenceRating/{{ data.bookingId }}">Violence rating</a>
                <strong class="govuk-tag app-task-list__task-completed" id="violenceRating-completed">Completed</strong>
              {% else %}
                {{ govukButton({
                text: "Start",
                href: "/form/ratings/violenceRating/" + data.bookingId,
                classes: "govuk-button--start tableButton app-task-list__task-completed",
                attributes:
                  {  'id': 'violenceButton' }
                }) }}
                <p class="govuk-!-font-weight-bold">Violence rating</p>
                <p class="govuk-body-s govuk-!-margin-top-2">Not yet checked</p>
              {% endif %}
            </li>
            <li class="app-task-list__item">
              {% if escapeRatingCompleted %}
                <a id="escape-input-edit" href="/form/ratings/escapeRating/{{ data.bookingId }}">Risk of escape</a>
                <strong class="govuk-tag app-task-list__task-completed" id="escapeRating-completed">Completed</strong>
              {% else %}
                {{ govukButton({
                text: "Start",
                href: "/form/ratings/escapeRating/" + data.bookingId,
                classes: "govuk-button--start tableButton app-task-list__task-completed",
                attributes:
                  {  'id': 'escapeButton' }
                }) }}
                <p class="govuk-!-font-weight-bold">Risk of escape</p>
                <p class="govuk-body-s govuk-!-margin-top-2">Not yet checked</p>
              {% endif %}
            </li>
            <li class="app-task-list__item">
              {% if extremismRatingCompleted %}
                <a href="/form/ratings/extremismRating/{{ data.bookingId }}">Extremism rating</a>
                <strong class="govuk-tag app-task-list__task-completed" id="extremismRating-completed">Completed</strong>
              {% else %}
                {{ govukButton({
                text: "Start",
                href: "/form/ratings/extremismRating/" + data.bookingId,
                classes: "govuk-button--start tableButton app-task-list__task-completed",
                attributes:
                  {  'id': 'extremismButton' }
                }) }}
                <p class="govuk-!-font-weight-bold">Extremism rating</p>
                <p class="govuk-body-s govuk-!-margin-top-2">Not yet checked</p>
              {% endif %}
            </li>
          </ul>
        </li>
        <li>
          <ul id="review" class="app-task-list__items">
            <li class="app-task-list__item">
              {% if data.categoriser.provisionalCategory.categoryAppropriate %}
                <a href="/form/categoriser/provisionalCategory/{{ data.bookingId }}">Review and categorisation</a>
                <strong class="govuk-tag app-task-list__task-completed" id="review-completed">Completed</strong>
              {% else %}
                {{ govukButton({
                  text: "Continue",
                  href: "/form/categoriser/review/" + data.bookingId if allSectionsCompleted,
                  disabled: not allSectionsCompleted,
                  classes: "govuk-button--start tableButton app-task-list__task-completed"
                }) }}
                <p class="govuk-!-font-weight-bold">Review and categorisation</p>
                <p class="govuk-body-s govuk-!-margin-top-2">Tasks not yet complete</p>
              {% endif %}
            </li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
{% endblock %}
